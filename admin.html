<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title> GREEN GOLDEN </title>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* (Ù†ÙØ³ CSS Ø§Ù„Ø®Ø§Øµ Ø¨ÙƒØŒ Ù‚ÙØµØ±Øª Ù‡Ù†Ø§ Ù„Ù„ÙˆØ¶ÙˆØ­ â€” Ø­Ø§ÙØ¸Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ…ÙŠÙ… ÙƒÙ…Ø§ Ù‡Ùˆ) */
        :root {
            --bg1: #0b3d0b;
            --bg2: #062006;
            --card: #163e16;
            --accent: #4caf50;
            --glass: rgba(255, 255, 255, 0.04)
        }

        * {
            box-sizing: border-box;
            font-family: 'Almarai', sans-serif
        }

        body {
            margin: 0;
            background: url('https://images.pexels.com/photos/13565199/pexels-photo-13565199.jpeg') no-repeat center center fixed;
            background-size: cover;
            color: #000000;
            font-weight: bold;
            min-height: 100vh;
        }

        header {
            padding: 18px 12px;
            text-align: center
        }

        header h1 {
            font-size: 34px;
            margin: 0;
            text-shadow: 0 6px 18px rgba(0, 0, 0, .6);
            animation: floatTitle 3s ease-in-out infinite
        }

        .container {
            width: 95%;
            max-width: 1200px;
            margin: 18px auto;
            display: flex;
            gap: 18px;
            align-items: flex-start
        }

        .left {
            flex: 1
        }

        .featured {
            background: var(--card);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden
        }

        .featured .title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px
        }

        .featured .title h2 {
            margin: 0;
            font-size: 18px
        }

        .featured-slider {
            display: flex;
            overflow: hidden;
            gap: 5px;
            padding: 6px 0;
            scroll-behavior: smooth
        }

        .featured-item {
            flex: 0 0 20%;
            min-width: 0;
            height: 170px;
            border-radius: 10px;
            background: #1f5a1f;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform .25s, box-shadow .25s
        }

        .featured-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block
        }

        .featured-item .meta {
            position: absolute;
            left: 8px;
            bottom: 8px;
            background: linear-gradient(90deg, rgba(0, 0, 0, .5), transparent);
            padding: 6px;
            border-radius: 6px;
            font-size: 13px;
            color: #fff
        }

        .cats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 12px 0;
            overflow: hidden
        }

        .cat-pill {
            background: rgba(255, 255, 255, 0.03);
            padding: 8px 12px;
            border-radius: 999px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.03);
            flex: 0 0 auto
        }

        .cat-pill.active {
            box-shadow: 0 6px 18px rgba(0, 0, 0, .6);
            background: linear-gradient(90deg, var(--accent), #2f8b2f);
            color: #fff
        }

        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
            overflow: hidden
        }

        .product {
            background: var(--card);
            border-radius: 14px;
            padding: 8px;
            position: relative;
            overflow: hidden;
            transition: transform .18s, box-shadow .18s
        }

        .product:hover {
            transform: translateY(-6px);
            box-shadow: 0 14px 30px rgba(0, 0, 0, .6);
            outline: 2px solid rgba(76, 175, 80, .12)
        }

        .p-img {
            width: 100%;
            height: 200px;
            border-radius: 10px;
            overflow: hidden;
            background: #123;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .p-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block
        }

        .p-meta {
            padding: 8px
        }

        .p-meta h3 {
            margin: 0 0 6px 0;
            font-size: 16px
        }

        .p-meta p {
            margin: 0 0 8px 0;
            font-size: 13px;
            color: #e8f7e8
        }

        .p-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px
        }

        .p-row .price {
            font-weight: 700
        }

        .p-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 8px
        }

        .p-actions input[type=number] {
            width: 64px;
            padding: 6px;
            border-radius: 6px;
            border: none;
            text-align: center
        }

        .p-actions button {
            padding: 8px 10px;
            border-radius: 8px;
            border: none;
            background: var(--accent);
            color: #042404;
            cursor: pointer;
            font-weight: 700
        }

        .p-actions .small {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, .06);
            color: #fff;
            padding: 6px 8px
        }

        .right {
            width: 340px;
            min-width: 260px
        }

        .cart-panel {
            background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, .01));
            padding: 12px;
            border-radius: 12px;
            position: sticky;
            top: 20px
        }

        .cart-panel h3 {
            margin: 0 0 8px 0;
            text-align: center
        }

        .cart-list {
            max-height: 340px;
            overflow: auto;
            padding: 6px;
            margin-bottom: 8px
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px;
            border-radius: 8px
        }

        .cart-item .name {
            font-size: 14px
        }

        .cart-total {
            font-weight: 700;
            text-align: center;
            margin: 8px 0
        }

        .big-btn {
            display: block;
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: none;
            background: var(--accent);
            color: #042404;
            font-weight: 800;
            cursor: pointer
        }

        #adminPanel {
            background: rgba(0, 0, 0, .55);
            padding: 12px;
            border-radius: 12px;
            margin-top: 12px;
            display: none
        }

        #adminPanel h4 {
            margin: 0 0 8px 0;
            text-align: center
        }

        #adminPanel label {
            display: block;
            font-size: 13px;
            margin-top: 8px
        }

        #adminPanel input[type=text],
        #adminPanel input[type=number],
        #adminPanel textarea,
        #adminPanel select {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, .08);
            color: #fff;
            border: 1px solid #4caf50;
            margin-top: 6px
        }

        #adminPanel input[type=file] {
            margin-top: 6px
        }

        #adminPanel .row {
            display: flex;
            gap: 8px
        }

        #adminPanel .row .col {
            flex: 1
        }

        .small-muted {
            font-size: 12px;
            color: #cfe9cf;
            margin-top: 6px
        }

        #loginOverlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .92);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999
        }

        #loginBox {
            width: 320px;
            padding: 18px;
            background: linear-gradient(180deg, #082b08, #052205);
            border-radius: 12px
        }

        #loginBox input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            margin-top: 8px;
            background: rgba(255, 255, 255, .03);
            color: #fff
        }

        #loginBox button {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: var(--accent);
            color: #042404;
            width: 100%;
            font-weight: 700;
            cursor: pointer
        }

        #toast {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            bottom: 18px;
            background: #1b501b;
            padding: 10px 14px;
            border-radius: 10px;
            display: none
        }

        @media(max-width:980px) {
            .container {
                flex-direction: column
            }

            .right {
                width: 100%
            }
        }

        button {
            background: linear-gradient(145deg, #006400, #00a000);
            color: #fff;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            cursor: pointer;
            transition: all .3s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, .3)
        }

        button:hover {
            background: linear-gradient(145deg, #00a000, #008000);
            transform: scale(1.05)
        }

        #exportBtn,
        #importBtn {
            pointer-events: none;
            /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± */
            opacity: 0.5;
            /* ÙŠØ®Ù„ÙŠ Ø§Ù„Ø²Ø±Ø§Ø± ÙŠØ¨Ø¯Ùˆ Ù…Ø¹Ø·Ù‘Ù„ */
            cursor: not-allowed;
            /* ÙŠØºÙŠÙ‘Ø± Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø´Ø± */
            display: none;
        }

        #changeBgBtn,
        #bgUrlInput,
        #setBgBtn {
            display: none;
            /* ÙŠØ®ÙÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        }

        label[for="bgUrlInput"],
        /* Ù„Ùˆ ÙÙŠ label Ù…Ø±Ø¨ÙˆØ· Ø¨Ø§Ù„Ù€ input */
        label {
            display: none;
            /* ÙŠØ®ÙÙŠ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„ØªØ³Ù…ÙŠØ§Øª */
        }
         .img-btn {
    width: 36px;   /* Ù†ÙØ³ Ø­Ø¬Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    height: 36px;
    border-radius: 50%;
    border: 2px solid #d4af37;
    background-color: #fff;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    padding: 3px;
    transition: 0.2s;
  }

  .img-btn:hover {
    transform: scale(1.15);
    background-color: #d4af37;
  }

  .img-btn img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
  }


        @keyframes floatTitle {
            0% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-6px)
            }

            100% {
                transform: translateY(0)
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>ğŸŒ¿ GREEN GOLDEN </h1>
    </header>
  <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div style="position: fixed; right: 10px; top: 15px; z-index: 1000;">
  <button class="img-btn" onclick="showLoginModal()">
    <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
  </button>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØµØºÙŠØ±Ø© -->
<div id="homeLoginModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
      background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.3); z-index:2000;">
  <h4 style="margin:0 0 10px 0;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h4>
  <input id="homeUsername" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" style="width:100%; margin-bottom:8px; padding:6px;">
  <input id="homePassword" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:100%; margin-bottom:8px; padding:6px;">
  <div style="text-align:right;">
    <button onclick="checkHomeLogin()" style="padding:5px 10px;">Ø¯Ø®ÙˆÙ„</button>
    <button onclick="closeHomeModal()" style="padding:5px 10px;">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
    </div>

    <div class="container" id="mainArea">
        <div class="left">
            <div class="featured">
                <div class="title">
                    <h2>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h2>
                    <div>
                        <button id="prevFeat" class="small-muted"
                            style="background:transparent;border:0;color:#d7ffd7;cursor:pointer"><i
                                class="fa fa-chevron-left"></i></button>
                        <button id="nextFeat" class="small-muted"
                            style="background:transparent;border:0;color:#d7ffd7;cursor:pointer"><i
                                class="fa fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="featured-slider" id="featuredSlider"></div>
            </div>

            <div style="display:flex;align-items:center;justify-content:space-between">
                <div style="color:#dff0dff2;font-size:15px">Ø§Ù„ÙØ¦Ø§Øª</div>
                <div><button id="showAll" class="cat-pill">Ø§Ù„ÙƒÙ„</button></div>
            </div>
            <div class="cats" id="catsRow"></div>

            <div class="products" id="productsGrid"></div>
        </div>

        <aside class="right">
            <div class="cart-panel" id="cartPanel">
                <h3>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
                <div class="cart-list" id="cartList"></div>
                <div class="cart-total" id="cartTotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 Ø¬Ù†ÙŠÙ‡</div>
                <button class="big-btn" id="checkoutBtn">Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
            </div>

            <div id="adminPanel">
                <h4>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h4>
                <div class="small-muted">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø²Ø± Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</div>

                <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
                <input type="text" id="prodImgUrl" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬">

                <label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="prodName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                <label>Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠÙ‡)</label><input type="number" id="prodPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">

                <label>Ø§Ù„ÙØ¦Ø©</label>
                <div class="row">
                    <div class="col"><select id="prodCategory">
                            <option value="">Ø§Ø®ØªØ± ÙØ¦Ø©</option>
                        </select></div>
                    <div class="col" style="flex:0 0 40px"><button id="addCategoryBtn" class="small-muted"
                            title="Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©"><i class="fa fa-plus"></i></button></div>
                </div>

                <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª -->
                <div id="categoryManager" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
     background:white;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.3);z-index:999;width:300px">
                    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª</h3>
                    <input type="text" id="newCategoryInput" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©"
                        style="width:100%;margin-bottom:10px">
                    <button id="saveNewCategory">â• Ø¥Ø¶Ø§ÙØ©</button>

                    <div id="categoriesList" style="margin-top:10px;max-height:250px;overflow-y:auto;"></div>

                    <button id="closeCatManager"
                        style="margin-top:10px;background:#f44336;color:white;padding:5px 10px;border:none;border-radius:5px;width:100%">
                        Ø¥ØºÙ„Ø§Ù‚
                    </button>
                </div>

                <label>Ø§Ù„ÙˆØµÙ</label><textarea id="prodDesc" rows="3" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ±"></textarea>

                <div style="display:flex;gap:8px;margin-top:10px">
                    <button id="changeBgBtn" class="small-muted" style="margin-top:10px">ğŸ¨ Ø§Ø®ØªÙŠØ§Ø± Ø®Ù„ÙÙŠØ©</button>
                    <button id="saveProdBtn" class="big-btn" style="flex:1">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
                    <button id="clearFormBtn" class="small-muted" style="flex:0 0 60px">Ù…Ø³Ø­</button>
                </div>

                <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                <input type="text" id="bgUrlInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ù„ÙÙŠØ© Ù‡Ù†Ø§">
                <button id="setBgBtn">Ø­ÙØ¸ Ø§Ù„Ø®Ù„ÙÙŠØ©</button>

                <label style="margin-top:12px">Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ù„Ø·Ù„Ø¨Ø§Øª)</label>
                <input type="text" id="whatsappNumber" placeholder="Ù…Ø«Ø§Ù„: 2010xxxxxxxx">

                <div style="display:flex;gap:8px;margin-top:10px">
                    <button id="exportBtn" class="small-muted" style="flex:1">ğŸ“¦ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <button id="importBtn" class="small-muted" style="flex:1">ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ (Ù…Ù† Ù…Ù„Ù JSON)</button>
                </div>

                <!-- Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù‡Ù†Ø§ -->
                <button id="exportOrdersBtn" class="small-muted" style="flex:1;margin-top:10px">ğŸ“Š ØªØµØ¯ÙŠØ±
                    Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>

                <div style="margin-top:10px;display:flex;gap:8px">
                    <button id="logoutBtn" class="small-muted" style="flex:1">Ø®Ø±ÙˆØ¬</button>
                    <button id="clearAllBtn" class="small-muted" style="flex:1">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                </div>

                <hr style="margin:12px 0; border-color:#4caf50">
                <h4>Ø¨Ø­Ø« ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h4>
                <div style="display:flex; gap:8px; margin-bottom:8px;">
                    <input type="text" id="searchInvoiceInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©">
                    <button id="searchInvoiceBtn" class="small-muted">ğŸ” Ø¨Ø­Ø«</button>
                </div>
                <div id="invoiceResult"></div>

            </div>
        </aside>
    </div>

    <!-- login overlay -->
    <div id="loginOverlay">
        <div id="loginBox">
            <h3 style="margin:0 0 6px 0;color:#dfffe0">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h3>
            <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
            <input id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password" />
            <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="toast"></div>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // JSONBin config
            const BIN_ID = "690874bad0ea881f40d07f5d";
            const MASTER_KEY = "$2a$10$MUgieOcdv8QNyPRuRsFb6eaAOYcAzxuWL6TB6FbI8L7fhZIVVibdO";
            const API_BASE = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

            // local keys
            const LS_PRODUCTS = 'osos_products_v1';
            const LS_CATS = 'osos_cats_v1';
            const LS_WHATS = 'osos_whatsapp_v1';
            const LS_BG = 'osos_bg_v1';
            const LS_ORDERS = 'orders_v1';

            // in-memory
            let products = [], categories = [], cart = [];

            // elements
            const productsGrid = document.getElementById('productsGrid');
            const catsRow = document.getElementById('catsRow');
            const prodCategory = document.getElementById('prodCategory');
            const featuredSlider = document.getElementById('featuredSlider');
            const cartList = document.getElementById('cartList');
            const cartTotal = document.getElementById('cartTotal');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const adminPanel = document.getElementById('adminPanel');
            const loginOverlay = document.getElementById('loginOverlay');
            const loginBtn = document.getElementById('loginBtn');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const saveProdBtn = document.getElementById('saveProdBtn');
            const prodImgFile = document.getElementById('prodImgFile');
            const prodImgUrl = document.getElementById('prodImgUrl');
            const prodName = document.getElementById('prodName');
            const prodPrice = document.getElementById('prodPrice');
            const prodDesc = document.getElementById('prodDesc');
            const addCategoryBtn = document.getElementById('addCategoryBtn');
            const whatsappNumberInput = document.getElementById('whatsappNumber');
            const exportBtn = document.getElementById('exportBtn');
            const importBtn = document.getElementById('importBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const clearFormBtn = document.getElementById('clearFormBtn');
            const clearAllBtn = document.getElementById('clearAllBtn');
            const prevFeat = document.getElementById('prevFeat');
            const nextFeat = document.getElementById('nextFeat');
            const showAllBtn = document.getElementById('showAll');
            const toastEl = document.getElementById('toast');
            const bgUrlInput = document.getElementById('bgUrlInput');
            const setBgBtn = document.getElementById('setBgBtn');
            const changeBgBtn = document.getElementById('changeBgBtn');
            const searchInvoiceInput = document.getElementById('searchInvoiceInput');
            const searchInvoiceBtn = document.getElementById('searchInvoiceBtn');
            const exportOrdersBtn = document.getElementById('exportOrdersBtn');

            // toast helper
            function toast(msg, time = 1400) {
                toastEl.textContent = msg;
                toastEl.style.display = 'block';
                setTimeout(() => toastEl.style.display = 'none', time);
            }

            // escape HTML
            function escapeHtml(text) {
                if (!text) return '';
                return text.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
            }

            // save/load local
            function saveLocalBackup() {
                localStorage.setItem(LS_PRODUCTS, JSON.stringify(products));
                localStorage.setItem(LS_CATS, JSON.stringify(categories));
                localStorage.setItem(LS_WHATS, whatsappNumberInput.value || '');
                localStorage.setItem(LS_BG, localStorage.getItem(LS_BG) || '');
                localStorage.setItem(LS_ORDERS, JSON.stringify(JSON.parse(localStorage.getItem(LS_ORDERS) || '[]')));
            }

            function loadBackgroundLocal() {
                const bg = localStorage.getItem(LS_BG);
                if (bg) applyBackground(bg);
            }

            function clearForm() {
                prodImgUrl.value = '';
                prodName.value = '';
                prodPrice.value = '';
                prodDesc.value = '';
                prodCategory.value = '';
                prodImgFile.value = '';
                saveProdBtn.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬';
                delete saveProdBtn.dataset.editIndex;
            }

            // background
            function applyBackground(url) {
                if (!url) {
                    document.body.style.background = 'linear-gradient(135deg,#0b3d0b,#062006)';
                } else {
                    document.body.style.background = `url('${url}') no-repeat center center/cover`;
                }
            }

            async function saveBackgroundToBin(url) {
                localStorage.setItem(LS_BG, url);
                applyBackground(url);
                await saveToBin();
                toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø®Ù„ÙÙŠØ©');
            }

            setBgBtn.addEventListener('click', () => {
                const url = bgUrlInput.value.trim();
                if (!url) return toast('Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ù„ÙÙŠØ© Ø£ÙˆÙ„Ø§Ù‹');
                saveBackgroundToBin(url);
            });

            changeBgBtn.addEventListener('click', () => {
                bgUrlInput.focus();
                toast('Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ù„ÙÙŠØ© Ø«Ù… Ø§Ø¶ØºØ· "Ø­ÙØ¸ Ø§Ù„Ø®Ù„ÙÙŠØ©"');
            });

            // render categories
            function renderCats() {
                catsRow.innerHTML = '';
                prodCategory.innerHTML = '<option value="">Ø§Ø®ØªØ± ÙØ¦Ø©</option>';
                categories.forEach(c => {
                    const pill = document.createElement('button');
                    pill.className = 'cat-pill';
                    pill.textContent = c;
                    pill.onclick = () => { filterByCategory(c); document.querySelectorAll('.cat-pill').forEach(el => el.classList.remove('active')); pill.classList.add('active'); };
                    catsRow.appendChild(pill);

                    const opt = document.createElement('option');
                    opt.value = c;
                    opt.text = c;
                    prodCategory.appendChild(opt);
                });
            }

            // render products
            function renderProducts(filterCat = '') {
                productsGrid.innerHTML = '';
                products.forEach((p, idx) => {
                    if (filterCat && p.category !== filterCat) return;
                    const card = document.createElement('div');
                    card.className = 'product';
                    card.innerHTML = `
                <div class="p-img"><img src="${p.img || 'https://i.imgur.com/6oKfLQk.jpg'}" alt=""></div>
                <div class="p-meta">
                  <h3>${escapeHtml(p.name)}</h3>
                  <p>${escapeHtml(p.desc || '')}</p>
                  <div class="p-row"><div class="price">${Number(p.price || 0).toFixed(2)} Ø¬Ù†ÙŠÙ‡</div><div style="font-size:12px;color:#cfe9cf">${p.category || 'Ø¹Ø§Ù…'}</div></div>
                  <div class="p-actions">
                    <input type="number" min="1" value="1" id="qty_${idx}">
                    <button class="addCart" data-index="${idx}">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
                    <button class="fav small" data-index="${idx}" title="Ø§Ø¶Ù Ù„Ù„Ù…Ù…ÙŠØ²Ø©"><i class="fa fa-star"></i></button>
                    <button class="edit small" data-index="${idx}" title="ØªØ¹Ø¯ÙŠÙ„">âœ</button>
                    <button class="del small" data-index="${idx}" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                  </div>
                </div>
            `;
                    card.addEventListener('mouseenter', () => { card.classList.add('flash'); setTimeout(() => card.classList.remove('flash'), 900); });
                    productsGrid.appendChild(card);
                });

                // attach events
                document.querySelectorAll('.addCart').forEach(btn => btn.onclick = e => {
                    const i = Number(e.currentTarget.dataset.index);
                    const q = Number(document.getElementById('qty_' + i).value || 1);
                    addToCart(i, q);
                });
                document.querySelectorAll('.fav').forEach(btn => btn.onclick = e => {
                    const i = Number(e.currentTarget.dataset.index);
                    products[i].featured = !products[i].featured;
                    saveLocalBackup(); saveToBin(); renderFeatured();
                    toast(products[i].featured ? 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù…ÙŠØ²Ø©' : 'Ø£Ø²ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ù…ÙŠØ²Ø©');
                });
                document.querySelectorAll('.edit').forEach(btn => btn.onclick = e => enterEdit(Number(e.currentTarget.dataset.index)));
                document.querySelectorAll('.del').forEach(btn => btn.onclick = e => {
                    const i = Number(e.currentTarget.dataset.index);
                    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
                        products.splice(i, 1); saveLocalBackup(); saveToBin(); renderProducts(); renderFeatured(); toast('ØªÙ… Ø§Ù„Ø­Ø°Ù');
                    }
                });
            }

            // featured
            function renderFeatured() {
                featuredSlider.innerHTML = '';
                const feats = products.filter(p => p.featured);
                if (feats.length === 0) { featuredSlider.innerHTML = '<div style="color:#cfe9cf">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø©</div>'; return; }
                feats.forEach(p => {
                    const item = document.createElement('div'); item.className = 'featured-item';
                    item.innerHTML = `<img src="${p.img || 'https://i.imgur.com/6oKfLQk.jpg'}" alt=""><div class="meta">${escapeHtml(p.name)}</div>`;
                    item.onclick = () => addToCart(products.indexOf(p), 1);
                    featuredSlider.appendChild(item);
                });
                featuredSlider.style.display = 'flex'; featuredSlider.style.overflow = 'hidden';
                featuredSlider.firstChild && (featuredSlider.firstChild.style.minWidth = 'calc(100% / 5)');
            }

            // cart
            function addToCart(i, qty) {
                const p = products[i];
                const found = cart.find(x => x.name === p.name && x.price === p.price);
                if (found) found.qty += qty; else cart.push({ name: p.name, price: p.price, qty });
                renderCart(); toast('Ø£Ø¶ÙŠÙ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©');
            }

            function renderCart() {
                cartList.innerHTML = ''; let total = 0;
                cart.forEach((c, i) => {
                    const div = document.createElement('div'); div.className = 'cart-item';
                    div.innerHTML = `<div><div class="name">${escapeHtml(c.name)}</div><div style="font-size:13px;color:#cfe9cf">${c.qty} Ã— ${c.price} Ø¬Ù†ÙŠÙ‡</div></div><div><button class="small-muted" data-i="${i}">Ù…Ø³Ø­</button></div>`;
                    cartList.appendChild(div);
                });
                document.querySelectorAll('.cart-item .small-muted').forEach(b => b.addEventListener('click', e => { cart.splice(Number(e.currentTarget.dataset.i), 1); renderCart(); }));
                cart.forEach(c => total += c.price * c.qty);
                cartTotal.textContent = 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ' + total + ' Ø¬Ù†ÙŠÙ‡';
            }

            checkoutBtn.addEventListener('click', async () => {
                const number = whatsappNumberInput.value.trim() || localStorage.getItem(LS_WHATS) || '';
                if (!number) { alert('Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ù… ÙŠØ¶Ø¹ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø¹Ø¯'); return; }
                if (cart.length === 0) { alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return; }

                // Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨
                let msg = `Ø·Ù„Ø¨ Ù…Ù† GOLDEN GREEN:%0A`;
                cart.forEach(c => msg += `${c.name} x ${c.qty} = ${c.price * c.qty} Ø¬Ù†ÙŠÙ‡%0A`);
                const url = `https://wa.me/${number}?text=${encodeURIComponent(msg)}`;
                window.open(url, '_blank');

                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                const invoiceNo = 'INV-' + Date.now();
                const date = new Date().toLocaleString();
                let orders = JSON.parse(localStorage.getItem('orders_v1') || '[]');

                // Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                const newInvoice = {
                    number: invoiceNo,
                    date: date,
                    name: '---',          // Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
                    phone1: number,       // Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
                    phone2: '',
                    seller: '',           // Ø§Ù„Ø¨Ø§Ø¦Ø¹
                    clientCode: '',
                    shipping: '',
                    deposit: 0,
                    status: 'ØªÙ… Ø§Ù„Ø·Ù„Ø¨',
                    notes: '',
                    details: cart.map(c => ({
                        name: c.name,
                        qty: c.qty,
                        price: c.price,
                        total: c.price * c.qty
                    }))
                };

                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                newInvoice.total = newInvoice.details.reduce((sum, p) => sum + p.total, 0);

                orders.push(newInvoice);
                localStorage.setItem('orders_v1', JSON.stringify(orders));
                await saveOrdersToBin(orders);

                cart = [];
                renderCart();
                toast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±');
            });


            // add/edit product
            saveProdBtn.addEventListener('click', () => {
                const name = prodName.value.trim();
                const price = Number(prodPrice.value);
                const desc = prodDesc.value.trim();
                const cat = prodCategory.value;
                let imgUrl = prodImgUrl.value.trim();
                const editIndex = saveProdBtn.dataset.editIndex;

                if (prodImgFile.files && prodImgFile.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function (e) { imgUrl = e.target.result; saveProduct(); };
                    reader.readAsDataURL(prodImgFile.files[0]);
                } else saveProduct();

                function saveProduct() {
                    if (!name || !price || !desc || !cat || !imgUrl) { alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ Ø§Ù„ØµÙˆØ±Ø©'); return; }

                    if (editIndex) {
                        products[Number(editIndex)] = { ...products[Number(editIndex)], name, price, desc, category: cat, img: imgUrl };
                        toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª');
                    } else { products.push({ name, price, desc, category: cat, img: imgUrl, featured: false }); toast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬'); }

                    saveLocalBackup();
                    saveToBin();
                    renderProducts();
                    renderFeatured();
                    clearForm();
                }
            });

            function enterEdit(i) {
                const p = products[i];
                prodImgUrl.value = p.img || '';
                prodName.value = p.name; prodPrice.value = p.price; prodDesc.value = p.desc;
                prodCategory.value = p.category || '';
                saveProdBtn.textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„'; saveProdBtn.dataset.editIndex = i;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            clearFormBtn.addEventListener('click', clearForm);

            // add category
            addCategoryBtn.addEventListener('click', () => {
                const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:');
                if (!name) return;
                if (categories.includes(name)) { toast('Ø§Ù„ÙØ¦Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„'); return; }
                categories.push(name);
                saveLocalBackup();
                saveToBin();
                renderCats();
                toast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø©');
            });

            // export/import
            exportBtn.addEventListener('click', () => {
                const data = { products, categories, whatsapp: whatsappNumberInput.value || '', background: localStorage.getItem(LS_BG) || '' };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'products.json'; a.click();
            });

            importBtn.addEventListener('click', () => {
                const f = document.createElement('input'); f.type = 'file'; f.accept = '.json';
                f.onchange = () => {
                    const file = f.files[0]; if (!file) return;
                    const r = new FileReader();
                    r.onload = e => {
                        try {
                            const obj = JSON.parse(e.target.result);
                            if (obj.products) products = obj.products;
                            if (obj.categories) categories = obj.categories;
                            if (obj.whatsapp) whatsappNumberInput.value = obj.whatsapp || '';
                            if (obj.background) localStorage.setItem(LS_BG, obj.background);
                            saveLocalBackup(); saveToBin();
                            renderCats(); renderProducts(); renderFeatured(); toast('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
                        } catch { alert('Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­'); }
                    };
                    r.readAsText(file);
                };
                f.click();
            });

            logoutBtn.addEventListener('click', () => { if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ØŸ')) { adminPanel.style.display = 'none'; loginOverlay.style.display = 'flex'; } });
            clearAllBtn.addEventListener('click', () => { if (confirm('Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ÙØ¦Ø§Øª. ØªØ§Ø¨Ø¹ØŸ')) { products = []; categories = []; saveLocalBackup(); saveToBin(); renderCats(); renderProducts(); renderFeatured(); toast('ØªÙ… Ø§Ù„Ù…Ø³Ø­'); } });

            // login
            loginBtn.addEventListener('click', () => {
                const user = usernameInput.value.trim();
                const pass = passwordInput.value.trim();
                if (user === 'tarek.azab' && pass === 'admin123') {
                    loginOverlay.style.display = 'none';
                    adminPanel.style.display = 'block';
                    whatsappNumberInput.value = localStorage.getItem(LS_WHATS) || '';
                    renderCats(); renderProducts(); renderFeatured(); renderCart(); toast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                } else alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
            });
            passwordInput.addEventListener('keypress', e => { if (e.key === 'Enter') loginBtn.click(); });

            // fetch/save JSONBin
            async function fetchFromBin() {
                toast('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...');
                try {
                    const res = await fetch(API_BASE + '/latest', { headers: { "X-Master-Key": MASTER_KEY } });
                    if (!res.ok) throw new Error('status ' + res.status);
                    const record = (await res.json()).record || {};
                    products = Array.isArray(record.products) ? record.products : [];
                    categories = Array.isArray(record.categories) ? record.categories : [];
                    if (record.whatsapp) whatsappNumberInput.value = record.whatsapp;
                    if (record.background) { localStorage.setItem(LS_BG, record.background); applyBackground(record.background); }
                    saveLocalBackup(); renderCats(); renderProducts(); renderFeatured(); renderCart();
                    toast('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† JSONBin');
                } catch (err) {
                    console.error(err);
                    toast('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù…Ù† JSONBin â€” Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
                    products = JSON.parse(localStorage.getItem(LS_PRODUCTS) || '[]');
                    categories = JSON.parse(localStorage.getItem(LS_CATS) || '[]');
                    whatsappNumberInput.value = localStorage.getItem(LS_WHATS) || '';
                    loadBackgroundLocal(); renderCats(); renderProducts(); renderFeatured(); renderCart();
                }
            }

            async function saveToBin() {
                toast('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…...');
                try {
                    const payload = { products, categories, whatsapp: whatsappNumberInput.value || '', background: localStorage.getItem(LS_BG) || '', invoices: JSON.parse(localStorage.getItem(LS_ORDERS) || '[]') };
                    const res = await fetch(API_BASE, { method: 'PUT', headers: { "X-Master-Key": MASTER_KEY, "Content-Type": "application/json" }, body: JSON.stringify(payload) });
                    if (!res.ok) throw new Error('status ' + res.status);
                    await res.json();
                    saveLocalBackup();
                    toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ JSONBin');
                } catch (err) {
                    console.error(err);
                    toast('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ JSONBin â€” ØªÙ… Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·');
                    saveLocalBackup();
                }
            }

            async function saveOrdersToBin(orders) {
                try {
                    let recordRes = await fetch(`${API_BASE}/latest`, { headers: { "X-Master-Key": MASTER_KEY } });
                    const json = await recordRes.json(); const record = json.record || {};
                    const payload = {
                        products: record.products || [],
                        categories: record.categories || [],
                        whatsapp: record.whatsapp || '',
                        background: record.background || '',
                        invoices: orders
                    };
                    await fetch(API_BASE, { method: 'PUT', headers: { "X-Master-Key": MASTER_KEY, "Content-Type": "application/json" }, body: JSON.stringify(payload) });
                } catch (err) { console.error(err); toast('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø¹Ù„Ù‰ JSONBin'); }
            }

            // filter/show all
            function filterByCategory(cat) { renderProducts(cat); }
            showAllBtn.addEventListener('click', () => { renderProducts(); document.querySelectorAll('.cat-pill').forEach(el => el.classList.remove('active')); });

            // featured auto-scroll
            let featTimer = setInterval(() => { const items = featuredSlider.children; if (items.length > 5) featuredSlider.appendChild(items[0]); }, 3000);
            prevFeat.onclick = () => { const items = featuredSlider.children; if (items.length <= 5) return; featuredSlider.insertBefore(items[items.length - 1], items[0]); };
            nextFeat.onclick = () => { const items = featuredSlider.children; if (items.length > 5) featuredSlider.appendChild(items[0]); };

            // initial load
            fetchFromBin();
            window.addEventListener('beforeunload', () => saveLocalBackup());

            // ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© XLSX
            const xlsxScript = document.createElement('script');
            xlsxScript.src = "https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";
            document.head.appendChild(xlsxScript);

            // search invoice
            searchInvoiceBtn.addEventListener('click', async () => {
                const val = searchInvoiceInput.value.trim();
                if (!val) return toast('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ø¨Ø­Ø«');
                toast('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø©...');
                try {
                    const res = await fetch(`${API_BASE}/latest`, { headers: { "X-Master-Key": MASTER_KEY } });
                    if (!res.ok) throw new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                    const invoices = (await res.json()).record.invoices || [];
                    const matched = invoices.filter(o => o.invoiceNo === val);
                    if (!matched.length) { toast('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ§ØªÙˆØ±Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…'); return; }
                    const o = matched[0];
                    const newWin = window.open('', '_blank');
                    newWin.document.write(`<html lang="ar" dir="rtl"><head><meta charset="UTF-8"><title>ÙØ§ØªÙˆØ±Ø© ${o.invoiceNo}</title><style>
                body { font-family: 'Almarai', sans-serif; background: rgba(0,0,0,0.8); color: #fff; padding:20px; text-align:center; }
                .invoice-box { background: rgba(255,255,255,0.1); border-radius:12px; padding:20px; margin:auto; width:80%; box-shadow:0 0 15px rgba(255,255,255,0.2);}
                h2 { color:#a8e6a2; margin-bottom:10px; }
                table { width:100%; border-collapse:collapse; margin-top:10px;}
                td, th { padding:8px; border-bottom:1px solid rgba(255,255,255,0.2); text-align:right; }
                .total { font-weight:bold; color:#ffeb3b; font-size:1.2em;}
                .print-btn { background:#4caf50; color:white; border:none; border-radius:8px; padding:10px 20px; cursor:pointer; margin-top:15px; }
                .print-btn:hover { background:#66bb6a; }
            </style></head><body><div class="invoice-box">
                <h2>ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… ${o.invoiceNo}</h2>
                <p>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${o.date}</p>
                <p>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${o.clientName || '---'}</p>
                <table>
                    <tr><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><td>${o.details}</td></tr>
                    <tr><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><td>${o.quantity}</td></tr>
                    <tr><th>Ø§Ù„Ø³Ø¹Ø±</th><td>${o.price} Ø¬Ù†ÙŠÙ‡</td></tr>
                    <tr class="total"><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><td>${o.total} Ø¬Ù†ÙŠÙ‡</td></tr>
                    <tr><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><td>${o.status || '---'}</td></tr>
                    <tr><th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th><td>${o.seller || '---'}</td></tr>
                    <tr><th>ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</th><td>${o.clientCode || '---'}</td></tr>
                    <tr><th>Ø§Ù„Ø´Ø­Ù†</th><td>${o.shipping || '---'}</td></tr>
                    <tr><th>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†</th><td>${o.deposit || '---'}</td></tr>
                    <tr><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><td>${o.notes || '---'}</td></tr>
                </table>
                <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
            </div></body></html>`);
                    newWin.document.close();
                    toast('âœ… ØªÙ… ÙØªØ­ ØµÙØ­Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­');
                } catch (err) { console.error(err); toast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«'); }
            });

            // export orders to Excel
            exportOrdersBtn.addEventListener('click', async () => {
                toast('â³ Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù Ø§Ù„ÙÙˆØ§ØªÙŠØ±...');
                try {
                    const res = await fetch(`${API_BASE}/latest`, { headers: { "X-Master-Key": MASTER_KEY } });
                    const invoices = (await res.json()).record.invoices || [];
                    if (!invoices.length) { toast('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯'); return; }
                    const sheetData = [['Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„', 'Ø§Ù„Ø¨ÙŠØ§Ù†', 'Ø§Ù„ÙƒÙ…ÙŠØ©', 'Ø§Ù„Ø³Ø¹Ø±', 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª', 'Ø§Ù„Ø¨Ø§Ø¦Ø¹', 'ØªÙ„ÙŠÙÙˆÙ†1', 'ØªÙ„ÙŠÙÙˆÙ†2', 'Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„', 'Ø§Ù„Ø´Ø­Ù†', 'Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†']];
                    invoices.forEach(o => sheetData.push([o.invoiceNo || '', o.date || '', o.clientName || '', o.details || '', o.quantity || '', o.price || '', o.total || '', o.notes || '', o.seller || '', o.phone1 || '', o.phone2 || '', o.trackingNo || '', o.status || '', o.clientCode || '', o.shipping || '', o.deposit || '']));
                    const workbook = XLSX.utils.book_new();
                    const worksheet = XLSX.utils.aoa_to_sheet(sheetData);
                    XLSX.utils.book_append_sheet(workbook, worksheet, 'Invoices');
                    const fileName = `ÙÙˆØ§ØªÙŠØ±_GOLDEN_GREEN_${new Date().toLocaleDateString('ar-EG').replace(/\//g, '-')}.xlsx`;
                    XLSX.writeFile(workbook, fileName);
                    toast('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
                } catch (err) { console.error(err); toast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± Ø§Ù„ÙÙˆØ§ØªÙŠØ±'); }
            });

        });
          function showLoginModal() {
    document.getElementById('homeLoginModal').style.display = 'block';
  }

  function closeHomeModal() {
    document.getElementById('homeLoginModal').style.display = 'none';
  }

  function checkHomeLogin() {
    const user = document.getElementById('homeUsername').value.trim();
    const pass = document.getElementById('homePassword').value;

    if(user === 'tarek.azab' && pass === 'admin123') {
      window.location.href = 'index.html';
    } else {
      alert('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
    }
  }

    </script>

</body>


</html>





